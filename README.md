# Установщик PostgreSQL на удаленный сервер

Данное консольное приложение предназначено для автоматизированной установки и настройки PostgreSQL на один из двух удаленных серверов.

## Функциональность

- Подключение к удаленным хостам по SSH с использованием ключа
- Оценка загруженности серверов и выбор наименее нагруженного
- Автоматическое определение типа операционной системы (Debian или CentOS/AlmaLinux)
- Установка PostgreSQL с использованием соответствующего пакетного менеджера
- Настройка PostgreSQL для приема внешних соединений
- Создание пользователя `student` с ограниченным доступом
- Тестирование работоспособности установленной базы данных

## Требования

- Python 3.6+
- Доступ к двум удаленным серверам с правами root
- SSH-ключ для аутентификации на серверах
- Установленная библиотека `paramiko` (автоматически устанавливается при использовании requirements.txt)

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/PavelTyazhev/remote-postgres-installer.git
cd remote-postgres-installer
```

2. Создайте виртуальное окружение (рекомендуется):
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
# или
venv\Scripts\activate  # для Windows
```

3. Установите необходимые зависимости:
```bash
pip install -r requirements.txt
```

## Использование

Запустите скрипт, указав IP-адреса или имена серверов через запятую:

```bash
python remote_postgres_installer.py 192.168.1.10,192.168.1.11
```

Если ваш SSH-ключ расположен не в стандартном месте (~/.ssh/id_rsa), укажите путь к нему с помощью параметра `--key`:

```bash
python remote_postgres_installer.py 192.168.1.10,192.168.1.11 --key /path/to/your/ssh/key
```

## Примеры использования

1. Установка PostgreSQL на один из двух серверов с использованием стандартного пути к SSH-ключу:
```bash
python remote_postgres_installer.py server1.example.com,server2.example.com
```

2. Установка с указанием пути к SSH-ключу:
```bash
python remote_postgres_installer.py 10.0.0.1,10.0.0.2 --key ~/.ssh/custom_key
```

## Принятые решения и особенности реализации

При разработке приложения были приняты следующие решения:

1. **Выбор языка**: Был выбран Python из-за простоты использования библиотеки `paramiko`

2. **Определение ОС**: Для определения типа операционной системы используется сочетание методов: проверка файла `/etc/os-release` и проверка наличия пакетных менеджеров `apt-get` и `yum`.

3. **Пароль пользователя**: Для пользователя `student` устанавливается пароль `StrongPassword123!`. В реальном производственном сценарии рекомендуется использовать более безопасный способ генерации и хранения паролей.

4. **Определение загрузки системы**: Для определения загрузки используется показатель средней загрузки системы за 1 минуту из файла `/proc/loadavg`.

5. **Обработка ошибок**: Приложение включает обработку различных ошибок, которые могут возникнуть при установке и настройке, и выводит понятные диагностические сообщения.

6. **Проверка соединения**: Для проверки работоспособности установленной базы данных выполняется простой SQL-запрос `SELECT 1`.
